# Заметка по теории BGP Communities Attribute

BGP Communities – э то расширение протокола BGP, которое предназначено для передачи дополнительной информации как соседним, так и удаленным узлам. Данное расширение описано в документе RFC 1997 (расширенные comminuties в RFC 4360) и его цель — помочь в администрировании политик и снизить сложность управления в сети Интернет. Community в общем смысле — группа получателей, объединенных неким общим свойством. Администратор каждой автономной системы определяет к какому community будет относиться тот или иной получатель. По умолчанию, все получатели относятся к community Internet.

Маршрутизатор, отправляющий сообщения BGP, может, используя атрибут  BGP Communities, контролировать какую информацию он принимает, предпочитает или распространяет соседям.
Если маршрутизатор получил маршрут от BGP с пустым полем COMMUNITIES, то он может добавить такой атрибут при распространении этого маршрута среди соседей.
Если маршрутизатор получил маршрут от BGP с заполненным полем  COMMUNITIES, то он может изменить этот атрибут в соответствии с локальными политиками.
Если маршрутизатор получил маршрут от BGP с заполненным полем  COMMUNITIES, то он может выполнить некоторое действие в соответствии с локальными политиками, например, изменить атрибут local-preference.

Сам атрибут пути COMMUNITIES, который относится к числу необязательных переходных атрибутов BGP, состоит из набора значений по 4 октета, каждое из которых задает community. Communities трактуются как 32-битные значения. Для общего удобства в первые 2 октета кодируется номер автономной системы, а кодирование оставшихся двух определяется администратором автономной системы.
Нужно иметь ввиду, что значения в диапазоне от 0x0000000 до 0x0000FFFF и от 0xFFFF0000 до 0xFFFFFFFF являются зарезервированными.

Также нужно иметь ввиду, что есть общепринятые группы:
- NO_EXPORT (0xFFFFFF01) - маршруты, содержащие атрибут communities с таким значением, недопустимо анонсировать за пределы конфедерации BGP (отдельные автономные системы, не входящие в конфедерацию, в этом случае рассматриваются как конфедерации);
- NO_ADVERTISE (0xFFFFFF02) - маршруты, содержащие атрибут communities с таким значением, недопустимо анонсировать соседям BGP;
- NO_EXPORT_SUBCONFED (0xFFFFFF03) - маршруты, содержащие атрибут communities с таким значением, недопустимо анонсировать внешним BGP соседям (включая соседей из других автономных систем данной конфедерации).
