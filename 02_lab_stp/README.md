# Лабораторная работа. Развертывание коммутируемой сети с резервными каналами

### Топология

![topology](topology_stp.png)

### Таблица Адресации

![topology](address_table.png)


## Цели

- [Часть 1. Создание сети и настройка основных параметров устройства](#part1)
- [Часть 2. Выбор корневого моста](#part2)
- [Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов](#part3)
- [Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов](#part4)

**Отказоустойчивость (Redundancy)** - повышает доступность устройств в сетевых топологиях, защищая сеть от **единой точки отказа (single point of failure)**. Отказоустойчивость в коммутируемой сети достигается за счет использования нескольких коммутаторов или нескольких соединений между коммутаторами. При добалении дополнительных линков между коммутаторами могут возникнуть **петли** (loop)и **дублирующиеся кадры**.

Протокол **Spanning Tree (STP)** был разработан как механизм избежания петель (loop) на втором уровне для резервных соединений в коммутируемой сети. **STP** обеспечивает наличие только одного логического пути между всеми пунктами назначения в сети, намеренно блокируя резервные пути, которые могут вызвать петлю.

В этой лабораторной работе мы будем использовать команду `show spanning-tree`, чтобы наблюдать процесс выбора **корневого моста (root bridge)** в STP.Мы также увидим процесс выбора порта на основе стоимости (cost) и приоритета (priority).

**Примечание**: Используются коммутаторы **Cisco vIOS** на платформе **EVE-NG**


<a name="part1"><h2>Часть 1. Создание сети и настройка основных параметров устройства</h2></a>

### **Шаг 1:	Создайте сеть согласно топологии.**

На данном этопе мы подключаем все коммутаторы между собой по паре соединений. 

### **Шаг 2:	Выполните инициализацию и перезагрузку коммутаторов.**

### **Шаг 3:	Настройте базовые параметры каждого коммутатора.**
+   
    + a. Отключите поиск DNS.

        `no ip domain-lookup`

    + b. Присвойте имена устройствам в соответствии с топологией.

        ```
        hostname SW1

        присвойте имена остальным свичам соотвественно (S2,S3)
        ```
        
    + c. Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.

        ```
        enable secret level 15 class
        ```

    + d. Назначьте cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.

        ```
        line vty 0 15
        password cisco
        login
        ```

    + e. Настройте logging synchronous для консольного канала.

        ```
        line con 0
        password cisco
        login
        logging synchronous
        ```

    + f. Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.

        ![motd](stp_motd.png)

    + g. Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.

        ```
        S1

        interface vlan 1
        ip address 192.168.1.1 255.255.255.0

        S2

        interface vlan 1
        ip address 192.168.1.2 255.255.255.0

        S3

        interface vlan 1
        ip address 192.168.1.3 255.255.255.0

        ```

    + h. Сохраните конфигурации на всех коммутаторах.

        ```
        copy running-config startup-config

        ```

### **Шаг 4:	Проверим соединение между всеми коммутаторами посредством пинга.**

```        
Пинг между S1 и S2? - OK
        
Пинг между S1 и S3? - OK

Пинг между S2 и S3? - OK
```

<a name="part2"><h2>Часть 2. Выбор корневого моста (Root Bridge)</h2></a>

Любая сеть, в которой развернут протокол spanning-tree (коммутируемая локальная сеть или широковещательный домен) имеет коммутатор, назначенный в качестве корневого моста. Корневой мост служит точкой отсчета для всех расчетов протокола spanning-tree, чтобы определить, какие порты на коммутаторе нужно блокировать.

Процесс выборов определяет, какой коммутатор станет корневым мостом (Root Bridge). Коммутатор с наименьшим идентификатором моста (BID) становится корневым мостом. BID состоит из значения приоритета моста, расширенного системного идентификатора и MAC-адреса коммутатора (см. картинку ниже). Значение приоритета может варьироваться от 0 до 65,535 с шагом 4,096, при этом значение по умолчанию равно 32,768.

![bid](stp_bid.png)

### **Шаг 1: Деактивируйте все порты на коммутаторах.**

```
S1(config)#interface range g0/0-3,g1/0-3
S1(config-if-range)#shutdown
```
Сделайте то же самое для S2 и S3

### **Шаг 2: Настройте подключенные порты как транковые.**

```
S1(config)#interface range g0/0-3

На некоторых более старых моделях коммутаторов необходим сначала ввести эту комманду, прежде чем смочь настроить линк между коммутаторами как транк.

S1(config-if-range)#switchport trunk encapsulation dot1q
S1(config-if-range)#switchport mode trunk


```
### **Шаг 3: Активируйте порты некоторые порты на всех коммутаторах. В нашем случае это следующие порты:**

```
S1(config)#interface range g0/0,g0/2
S1(config-if-range)#no shutdown

S2(config)#interface range g0/0,g0/3
S2(config-if-range)#no shutdown

S3(config)#interface range g0/1,g0/2
S3(config-if-range)#no shutdown
```

### **Шаг 4: Отобразите информацию о spanning-tree.**

Выполните команду **show spanning-tree** на всех трех коммутаторах. Приоритет идентификатора моста (**Bridge ID Priority**) рассчитывается путем сложения значения приоритета (**32768**) и расширенного системного идентификатора (**1**). Расширенный системный идентификатор всегда равен номеру VLAN. В приведенном ниже примере все три коммутатора имеют одинаковые значения приоритета идентификатора моста (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер VLAN = 1); следовательно, коммутатор с наименьшим MAC-адресом становится корневым мостом. (S1 в нашем примере)

![show_001](show_001.png)

![show_002](show_002.png)

![show_003](show_003.png)

На картинке ниже можно увидеть какие порты открыты, а какие были заблокированы в результате расчета **STP**

![stp_role](stp_roles.png)

Теперь мы можем ответить на следующие вопросы:

1. Какой коммутатор является корневым мостом?

```
Корневым коммутатором является **SW1**
```

2. Почему протокол **spanning-tree** выбрал этот коммутатор в качестве корневого моста?

```
Так как MAC адрес у SW1 по его числовому значению имеет наименьшее значение по сравнению с SW2 и SW3
```

3. Какие порты являются корневыми на коммутаторах?

```
SW2 - G0/0
SW3 - G0/2
```

4. Какие порты являются назначенными на коммутаторах?

```
SW1 - 
```

5. Какой порт отображается как альтернативный и в данный момент блокируется?

```

```








<a name="part3"><h2>Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов</h2></a>


<a name="part4"><h2>Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов</h2></a>



